ASM = nasm
ASM_FLAGS = -f elf64
TARGET = lib.o
SRC = lib.asm

.PHONY: clean test

.DEFAULT_GOAL := $(TARGET)

$(TARGET): $(SRC) lib.inc
	@echo "–°–æ–±–∏—Ä–∞–µ–º... üòº"
	$(ASM) $(ASM_FLAGS) -o $@ $(SRC)
	@echo "–ì–û–û–û–û–û–û–û–û–û–õ! üéâ"

clean:
	@echo "–ß–∏—Å—Ç–∏–º... üßπ"
	rm -rf parse* print* read* string* report.xml $(TARGET) __pycache__
	@echo "–ì–û–û–û–û–û–û–û–û–û–õ! üöÄ"

test: $(TARGET)
	@echo "–¢–µ—Å—Ç–∏—Ä—É–µ–º... üß™"
	python test.py || { echo "–¢–µ—Å—Ç—ã —Å–ª–∏—Ç—ã, –∏–¥–∏ –ø–µ—Ä–µ–ø–∏—Å—ã–≤–∞–π –∫–æ–¥ ‚ùå" && exit 1; }
	@echo "–ì–û–û–û–û–û–û–û–û–û–õ! ‚úÖ"